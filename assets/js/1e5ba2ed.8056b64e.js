"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[942],{88655:(n,e,s)=>{s.r(e),s.d(e,{assets:()=>a,contentTitle:()=>d,default:()=>_,frontMatter:()=>c,metadata:()=>r,toc:()=>t});const r=JSON.parse('{"id":"TOC/computer/kernel/lkd/ch05","title":"\u7b2c 5 \u7ae0 \u7cfb\u7edf\u8c03\u7528","description":"- \u7b2c 5 \u7ae0 \u7cfb\u7edf\u8c03\u7528","source":"@site/docs/TOC/computer/kernel/lkd/ch05.md","sourceDirName":"TOC/computer/kernel/lkd","slug":"/TOC/computer/kernel/lkd/ch05","permalink":"/docs/TOC/computer/kernel/lkd/ch05","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"\u7b2c 4 \u7ae0 \u8fdb\u7a0b\u8c03\u5ea6","permalink":"/docs/TOC/computer/kernel/lkd/ch04"},"next":{"title":"\u7b2c 6 \u7ae0 \u5185\u6838\u6570\u636e\u7ed3\u6784","permalink":"/docs/TOC/computer/kernel/lkd/ch06"}}');var l=s(74848),i=s(28453);const c={},d="\u7b2c 5 \u7ae0 \u7cfb\u7edf\u8c03\u7528",a={},t=[{value:"5.1 \u4e0e\u5185\u6838\u901a\u4fe1",id:"51-\u4e0e\u5185\u6838\u901a\u4fe1",level:2},{value:"5.2 API\u3001POSIX\u548cC\u5e93",id:"52-apiposix\u548cc\u5e93",level:2},{value:"5.3 \u7cfb\u7edf\u8c03\u7528",id:"53-\u7cfb\u7edf\u8c03\u7528",level:2},{value:"5.3.1 \u7cfb\u7edf\u8c03\u7528\u53f7",id:"531-\u7cfb\u7edf\u8c03\u7528\u53f7",level:3},{value:"5.3.2 \u7cfb\u7edf\u8c03\u7528\u7684\u6027\u80fd",id:"532-\u7cfb\u7edf\u8c03\u7528\u7684\u6027\u80fd",level:3},{value:"5.4 \u7cfb\u7edf\u8c03\u7528\u5904\u7406\u7a0b\u5e8f",id:"54-\u7cfb\u7edf\u8c03\u7528\u5904\u7406\u7a0b\u5e8f",level:2},{value:"5.4.1 \u6307\u5b9a\u6070\u5f53\u7684\u7cfb\u7edf\u8c03\u7528",id:"541-\u6307\u5b9a\u6070\u5f53\u7684\u7cfb\u7edf\u8c03\u7528",level:3},{value:"5.4.2 \u53c2\u6570\u4f20\u9012",id:"542-\u53c2\u6570\u4f20\u9012",level:3},{value:"5.5 \u7cfb\u7edf\u8c03\u7528\u7684\u5b9e\u73b0",id:"55-\u7cfb\u7edf\u8c03\u7528\u7684\u5b9e\u73b0",level:2},{value:"5.5.1 \u5b9e\u73b0\u7cfb\u7edf\u8c03\u7528",id:"551-\u5b9e\u73b0\u7cfb\u7edf\u8c03\u7528",level:3},{value:"5.5.2 \u53c2\u6570\u9a8c\u8bc1",id:"552-\u53c2\u6570\u9a8c\u8bc1",level:3},{value:"5.6 \u7cfb\u7edf\u8c03\u7528\u4e0a\u4e0b\u6587",id:"56-\u7cfb\u7edf\u8c03\u7528\u4e0a\u4e0b\u6587",level:2},{value:"5.6.1 \u7ed1\u5b9a\u4e00\u4e2a\u7cfb\u7edf\u8c03\u7528\u7684\u6700\u540e\u6b65\u9aa4",id:"561-\u7ed1\u5b9a\u4e00\u4e2a\u7cfb\u7edf\u8c03\u7528\u7684\u6700\u540e\u6b65\u9aa4",level:3},{value:"5.6.2 \u4ece\u7528\u6237\u7a7a\u95f4\u8bbf\u95ee\u7cfb\u7edf\u8c03\u7528",id:"562-\u4ece\u7528\u6237\u7a7a\u95f4\u8bbf\u95ee\u7cfb\u7edf\u8c03\u7528",level:3},{value:"5.6.3 \u4e3a\u4ec0\u4e48\u4e0d\u901a\u8fc7\u7cfb\u7edf\u8c03\u7528\u7684\u65b9\u5f0f\u5b9e\u73b0",id:"563-\u4e3a\u4ec0\u4e48\u4e0d\u901a\u8fc7\u7cfb\u7edf\u8c03\u7528\u7684\u65b9\u5f0f\u5b9e\u73b0",level:3}];function h(n){const e={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...n.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(e.header,{children:(0,l.jsx)(e.h1,{id:"\u7b2c-5-\u7ae0-\u7cfb\u7edf\u8c03\u7528",children:"\u7b2c 5 \u7ae0 \u7cfb\u7edf\u8c03\u7528"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.a,{href:"#%E7%AC%AC-5-%E7%AB%A0-%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8",children:"\u7b2c 5 \u7ae0 \u7cfb\u7edf\u8c03\u7528"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"#51-%E4%B8%8E%E5%86%85%E6%A0%B8%E9%80%9A%E4%BF%A1",children:"5.1 \u4e0e\u5185\u6838\u901a\u4fe1"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"#52-apiposix%E5%92%8Cc%E5%BA%93",children:"5.2 API\u3001POSIX\u548cC\u5e93"})}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.a,{href:"#53-%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8",children:"5.3 \u7cfb\u7edf\u8c03\u7528"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"#531-%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E5%8F%B7",children:"5.3.1 \u7cfb\u7edf\u8c03\u7528\u53f7"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"#532-%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E7%9A%84%E6%80%A7%E8%83%BD",children:"5.3.2 \u7cfb\u7edf\u8c03\u7528\u7684\u6027\u80fd"})}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.a,{href:"#54-%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E5%A4%84%E7%90%86%E7%A8%8B%E5%BA%8F",children:"5.4 \u7cfb\u7edf\u8c03\u7528\u5904\u7406\u7a0b\u5e8f"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"#541-%E6%8C%87%E5%AE%9A%E6%81%B0%E5%BD%93%E7%9A%84%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8",children:"5.4.1 \u6307\u5b9a\u6070\u5f53\u7684\u7cfb\u7edf\u8c03\u7528"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"#542-%E5%8F%82%E6%95%B0%E4%BC%A0%E9%80%92",children:"5.4.2 \u53c2\u6570\u4f20\u9012"})}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.a,{href:"#55-%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E7%9A%84%E5%AE%9E%E7%8E%B0",children:"5.5 \u7cfb\u7edf\u8c03\u7528\u7684\u5b9e\u73b0"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"#551-%E5%AE%9E%E7%8E%B0%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8",children:"5.5.1 \u5b9e\u73b0\u7cfb\u7edf\u8c03\u7528"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"#552-%E5%8F%82%E6%95%B0%E9%AA%8C%E8%AF%81",children:"5.5.2 \u53c2\u6570\u9a8c\u8bc1"})}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.a,{href:"#56-%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E4%B8%8A%E4%B8%8B%E6%96%87",children:"5.6 \u7cfb\u7edf\u8c03\u7528\u4e0a\u4e0b\u6587"})," - ",(0,l.jsx)(e.a,{href:"#561-%E7%BB%91%E5%AE%9A%E4%B8%80%E4%B8%AA%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E7%9A%84%E6%9C%80%E5%90%8E%E6%AD%A5%E9%AA%A4",children:"5.6.1 \u7ed1\u5b9a\u4e00\u4e2a\u7cfb\u7edf\u8c03\u7528\u7684\u6700\u540e\u6b65\u9aa4"})," - ",(0,l.jsx)(e.a,{href:"#562-%E4%BB%8E%E7%94%A8%E6%88%B7%E7%A9%BA%E9%97%B4%E8%AE%BF%E9%97%AE%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8",children:"5.6.2 \u4ece\u7528\u6237\u7a7a\u95f4\u8bbf\u95ee\u7cfb\u7edf\u8c03\u7528"})," - ",(0,l.jsx)(e.a,{href:"#563-%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E9%80%9A%E8%BF%87%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E7%9A%84%E6%96%B9%E5%BC%8F%E5%AE%9E%E7%8E%B0",children:"5.6.3 \u4e3a\u4ec0\u4e48\u4e0d\u901a\u8fc7\u7cfb\u7edf\u8c03\u7528\u7684\u65b9\u5f0f\u5b9e\u73b0"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.code,{children:"include/linux/syscalls.h"}),":"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-c",children:"#define SYSCALL_DEFINE(name) static inline long SYSC_##name\n#define SYSCALL_DEFINE0(name)    asmlinkage long sys_##name(void)\n#define SYSCALL_DEFINE1(name, ...) SYSCALL_DEFINEx(1, _##name, __VA_ARGS__)\n#define SYSCALL_DEFINE2(name, ...) SYSCALL_DEFINEx(2, _##name, __VA_ARGS__)\n#define SYSCALL_DEFINE3(name, ...) SYSCALL_DEFINEx(3, _##name, __VA_ARGS__)\n#define SYSCALL_DEFINE4(name, ...) SYSCALL_DEFINEx(4, _##name, __VA_ARGS__)\n#define SYSCALL_DEFINE5(name, ...) SYSCALL_DEFINEx(5, _##name, __VA_ARGS__)\n#define SYSCALL_DEFINE6(name, ...) SYSCALL_DEFINEx(6, _##name, __VA_ARGS__)\n\n\n/*\n * Example\n */\n\n/**\n * sys_sched_setparam - set/change the RT priority of a thread\n * @pid: the pid in question.\n * @param: structure containing the new RT priority.\n */\nSYSCALL_DEFINE2(sched_setparam, pid_t, pid, struct sched_param __user *, param)\n{\n return do_sched_setscheduler(pid, -1, param);\n}\n\n#define SYSCALL_DEFINE(name) static inline long SYSC_##name\n#define SYSCALL_DEFINE0(name)    asmlinkage long sys_##name(void)\n#define SYSCALL_DEFINE1(name, ...) SYSCALL_DEFINEx(1, _##name, __VA_ARGS__)\n#define SYSCALL_DEFINE2(name, ...) SYSCALL_DEFINEx(2, _##name, __VA_ARGS__)\n#define SYSCALL_DEFINE3(name, ...) SYSCALL_DEFINEx(3, _##name, __VA_ARGS__)\n#define SYSCALL_DEFINE4(name, ...) SYSCALL_DEFINEx(4, _##name, __VA_ARGS__)\n#define SYSCALL_DEFINE5(name, ...) SYSCALL_DEFINEx(5, _##name, __VA_ARGS__)\n#define SYSCALL_DEFINE6(name, ...) SYSCALL_DEFINEx(6, _##name, __VA_ARGS__)\n\n\n/*\n * Example\n */\n\n/**\n * sys_sched_setparam - set/change the RT priority of a thread\n * @pid: the pid in question.\n * @param: structure containing the new RT priority.\n */\nSYSCALL_DEFINE2(sched_setparam, pid_t, pid, struct sched_param __user *, param)\n{\n return do_sched_setscheduler(pid, -1, param);\n}\n\n"})}),"\n",(0,l.jsx)(e.h2,{id:"51-\u4e0e\u5185\u6838\u901a\u4fe1",children:"5.1 \u4e0e\u5185\u6838\u901a\u4fe1"}),"\n",(0,l.jsx)(e.p,{children:"\u7cfb\u7edf\u8c03\u7528\u5728\u7528\u6237\u7a7a\u95f4\u548c\u786c\u4ef6\u8bbe\u5907\u4e4b\u95f4\u6dfb\u52a0\u4e86\u4e00\u4e2a\u4e2d\u95f4\u5c42\u3002\u4e3b\u8981\u4f5c\u7528\uff1a"}),"\n",(0,l.jsxs)(e.blockquote,{children:["\n",(0,l.jsx)(e.p,{children:"\u4e3a\u7528\u6237\u7a7a\u95f4\u63d0\u4f9b\u4e86\u4e00\u4e2a\u786c\u4ef6\u7684\u62bd\u8c61\u63a5\u53e3\u3002"}),"\n",(0,l.jsx)(e.p,{children:"\u4fdd\u8bc1\u4e86\u7cfb\u7edf\u7684\u7a33\u5b9a\u548c\u5b89\u5168\u3002"}),"\n",(0,l.jsx)(e.p,{children:"\u9664\u5f02\u5e38\u548c\u9677\u5165\u5916\u7528\u6237\u7a7a\u95f4\u8bbf\u95ee\u5185\u6838\u552f\u4e00\u7684\u5408\u6cd5\u5165\u53e3\u3002"}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"52-apiposix\u548cc\u5e93",children:"5.2 API\u3001POSIX\u548cC\u5e93"}),"\n",(0,l.jsx)("div",{style:{textAlign:"center"},children:(0,l.jsx)("img",{src:s(99372).A,style:{zoom:"50%"}})}),"\n",(0,l.jsx)(e.h2,{id:"53-\u7cfb\u7edf\u8c03\u7528",children:"5.3 \u7cfb\u7edf\u8c03\u7528"}),"\n",(0,l.jsxs)(e.p,{children:["\u7cfb\u7edf\u8c03\u7528\u6700\u7ec8\u5177\u6709\u4e00\u79cd\u660e\u786e\u7684\u64cd\u4f5c\u3002\u5982",(0,l.jsx)(e.code,{children:"getpid()"})]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-c",children:"/**\n * sys_getpid - return the thread group id of the current process\n *\n * Note, despite the name, this returns the tgid not the pid.  The tgid and\n * the pid are identical unless CLONE_THREAD was specified on clone() in\n * which case the tgid is the same in all threads of the same group.\n *\n * This is SMP safe as current->tgid does not change.\n */\nSYSCALL_DEFINE0(getpid)\n{\n return task_tgid_vnr(current);\n}\n\n/**\n * expand\n */\nasmlinkage long sys_getpid(void);\n"})}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.code,{children:"asmlinkage"}),"\u901a\u77e5\u7f16\u8bd1\u5668\u4ec5\u4ece\u6808\u4e2d\u63d0\u53d6\u8be5\u51fd\u6570\u7684\u53c2\u6570\u3002"]}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.code,{children:"getpid()"}),"\u5728\u5185\u6838\u4e2d\u88ab\u5b9a\u4e49\u6210",(0,l.jsx)(e.code,{children:"sys_getpid()"}),"\u3002\u8fd9\u662f\u6240\u6709Linux\u7cfb\u7edf\u90fd\u5e94\u8be5\u9075\u5b88\u7684\u547d\u540d\u89c4\u5219 \u3002"]}),"\n",(0,l.jsx)(e.h3,{id:"531-\u7cfb\u7edf\u8c03\u7528\u53f7",children:"5.3.1 \u7cfb\u7edf\u8c03\u7528\u53f7"}),"\n",(0,l.jsxs)(e.p,{children:["\u6bcf\u4e2a\u7cfb\u7edf\u8c03\u7528\u90fd\u88ab\u8d4b\u4e88\u4e00\u4e2a\u7cfb\u7edf\u8c03\u7528\u53f7\u3002\u901a\u8fc7\u8fd9\u4e2a\u552f\u4e00\u7684\u53f7\u53ef\u4ee5\u5173\u8054\u7cfb\u7edf\u8c03\u7528\u3002",(0,l.jsx)(e.strong,{children:"\u8fdb\u7a0b\u4e0d\u4f1a\u63d0\u53ca\u7cfb\u7edf\u8c03\u7528\u7684\u540d\u79f0\u3002"})]}),"\n",(0,l.jsxs)(e.p,{children:["\u7cfb\u7edf\u8c03\u7528\u53f7\uff1a**\u4e00\u65e6\u5206\u914d\u5c31\u4e0d\u80fd\u518d\u6709\u4efb\u4f55\u53d8\u66f4\u3002\u5426\u5219\u7f16\u8bd1\u597d\u7684\u5e94\u7528\u7a0b\u5e8f\u5c31\u4f1a\u5d29\u6e83\u3002**\u5220\u9664\u7684\u7cfb\u7edf\u8c03\u7528\u6240\u5360\u7528\u7684\u7cfb\u7edf\u8c03\u7528\u53f7\u4e5f\u4e0d\u5141\u8bb8\u88ab\u56de\u6536\u5229\u7528\u3002\u5426\u5219\u4ee5\u524d\u7f16\u8bd1\u8fc7\u7684\u4ee3\u7801\u4f1a\u8c03\u7528\u8fd9\u4e2a\u7cfb\u7edf\u8c03\u7528\u3002Linux\u6709\u4e00\u4e2a\u201c\u672a\u5b9e\u73b0\u201d\u7684\u7cfb\u7edf\u8c03\u7528",(0,l.jsx)(e.code,{children:"sys_ni_syscall()"}),"\uff0c\u53ea\u8fd4\u56de",(0,l.jsx)(e.code,{children:"-ENOSYS"}),"\u3002\u8d1f\u8d23\u4e3a\u88ab\u5220\u9664\u6216\u4e0d\u53ef\u7528\u7684\u7cfb\u7edf\u8c03\u7528\u586b\u8865\u7a7a\u7f3a\u3002"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-c",children:"/*\n * Non-implemented system calls get redirected here.\n */\nasmlinkage long sys_ni_syscall(void)\n{\n return -ENOSYS;\n}\n"})}),"\n",(0,l.jsxs)(e.p,{children:["\u5185\u6838",(0,l.jsx)(e.code,{children:"sys_call_table"}),"\u8bb0\u5f55\u4e86\u7cfb\u7edf\u8c03\u7528\u8868\u4e2d\u6240\u6709\u5df2\u6ce8\u518c\u8fc7\u7684\u7cfb\u7edf\u8c03\u7528\u7684\u5217\u8868\uff0c\u5b9a\u4e49\u5728",(0,l.jsx)(e.code,{children:"arch/x86/kernel/syscall_64.c"}),"\u6587\u4ef6\u4e2d\u3002"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-c",children:"const sys_call_ptr_t sys_call_table[__NR_syscall_max+1] = {\n /*\n *Smells like a like a compiler bug -- it doesn't work\n *when the & below is removed.\n */\n [0 ... __NR_syscall_max] = &sys_ni_syscall,\n#include <asm/unistd_64.h>\n};\n"})}),"\n",(0,l.jsx)(e.h3,{id:"532-\u7cfb\u7edf\u8c03\u7528\u7684\u6027\u80fd",children:"5.3.2 \u7cfb\u7edf\u8c03\u7528\u7684\u6027\u80fd"}),"\n",(0,l.jsxs)(e.blockquote,{children:["\n",(0,l.jsx)(e.p,{children:"Linux\u7cfb\u7edf\u8c03\u7528\u6bd4\u5176\u4ed6\u8bb8\u591a\u64cd\u4f5c\u7cfb\u7edf\u6267\u884c\u5f97\u8981\u5feb\u3002Linux\u5f88\u77ed\u7684\u4e0a\u4e0b\u6587\u5207\u6362\u65f6\u95f4\u662f\u4e00\u4e2a\u91cd\u8981\u539f\u56e0\uff0c\u8fdb\u51fa\u5185\u6838\u90fd\u88ab\u4f18\u5316\u5f97\u7b80\u6d01\u9ad8\u6548\u3002\u53e6\u5916\u4e00\u4e2a\u539f\u56e0\u7cfb\u7edf\u8c03\u7528\u5904\u7406\u7a0b\u5e8f\u548c\u6bcf\u4e2a\u7cfb\u7edf\u8c03\u7528\u672c\u8eab\u90fd\u975e\u5e38\u7b80\u6d01\u3002"}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"54-\u7cfb\u7edf\u8c03\u7528\u5904\u7406\u7a0b\u5e8f",children:"5.4 \u7cfb\u7edf\u8c03\u7528\u5904\u7406\u7a0b\u5e8f"}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"\u7528\u6237\u7a7a\u95f4\u7684\u7a0b\u5e8f\u65e0\u6cd5\u76f4\u63a5\u6267\u884c\u5185\u6838\u4ee3\u7801\u3002"})}),"\n",(0,l.jsx)(e.p,{children:"\u901a\u77e5\u5185\u6838\u901a\u8fc7\u8f6f\u4e2d\u65ad\uff1a\u901a\u8fc7\u5f15\u53d1\u4e00\u4e2a\u5f02\u5e38\u6765\u4fc3\u4f7f\u7cfb\u7edf\u5207\u6362\u5230\u5185\u6838\u6001\u53bb\u6267\u884c\u5f02\u5e38\u5904\u7406\u7a0b\u5e8f\u3002"}),"\n",(0,l.jsx)(e.h3,{id:"541-\u6307\u5b9a\u6070\u5f53\u7684\u7cfb\u7edf\u8c03\u7528",children:"5.4.1 \u6307\u5b9a\u6070\u5f53\u7684\u7cfb\u7edf\u8c03\u7528"}),"\n",(0,l.jsxs)(e.p,{children:["\u56e0\u4e3a\u6240\u6709\u7684\u7cfb\u7edf\u8c03\u7528\u9677\u5165\u5185\u6838\u7684\u65b9\u5f0f\u90fd\u4e00\u6837\uff0c\u56e0\u6b64\u5fc5\u987b\u628a\u7cfb\u7edf\u8c03\u7528\u53f7\u4e00\u5e76\u4f20\u9012, \u901a\u8fc7",(0,l.jsx)(e.code,{children:"%eax"}),"\u5bc4\u5b58\u5668\u3002"]}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.code,{children:"system_call()"}),"\u51fd\u6570\u901a\u8fc7\u5c06\u7ed9\u5b9a\u7684\u7cfb\u7edf\u8c03\u7528\u53f7\u4e0e",(0,l.jsx)(e.code,{children:"NR_syscalls"}),"\u505a\u6bd4\u8f83\u6765\u68c0\u67e5\u6709\u6548\u6027\uff0c\u65e0\u6548\u8fd4\u56de",(0,l.jsx)(e.code,{children:"-NOSYS"}),"\uff0c\u5426\u5219\u8fd4\u56de\u76f8\u5e94\u7684\u7cfb\u7edf\u8c03\u7528\u3002"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-c",children:"/*\n * Register setup:\n * rax  system call number\n * rdi  arg0\n * rcx  return address for syscall/sysret, C arg3\n * rsi  arg1\n * rdx  arg2\n * r10  arg3  (--\x3e moved to rcx for C)\n * r8   arg4\n * r9   arg5\n * r11  eflags for syscall/sysret, temporary for C\n * r12-r15,rbp,rbx saved by C code, not touched.\n *\n * Interrupts are off on entry.\n * Only called from user space.\n *\n * XXX if we had a free scratch register we could save the RSP into the stack frame\n *      and report it properly in ps. Unfortunately we haven't.\n *\n * When user can change the frames always force IRET. That is because\n * it deals with uncanonical addresses better. SYSRET has trouble\n * with them due to bugs in both AMD and Intel CPUs.\n */\n\nENTRY(system_call)\n\n\n        ...\n\n        call *sys_call_table(,%rax,8)\n\n        ...\n"})}),"\n",(0,l.jsx)(e.h3,{id:"542-\u53c2\u6570\u4f20\u9012",children:"5.4.2 \u53c2\u6570\u4f20\u9012"}),"\n",(0,l.jsxs)(e.p,{children:["\u901a\u8fc7\u5bc4\u5b58\u5668",(0,l.jsx)(e.code,{children:"%ebx, %ecx, %edx, %esi, %edi"}),"\u4f20\u9012\u53c2\u6570\uff0c\u53c2\u8003 CSAPP: Chapter 3\u3002"]}),"\n",(0,l.jsx)(e.p,{children:"\u9700\u8981\uff16\u4e2a\u6216\uff16\u4e2a\u4ee5\u4e0a\u53c2\u6570\u65f6\uff0c\u5e94\u8be5\u7528\u4e00\u4e2a\u5355\u72ec\u7684\u5bc4\u5b58\u5668\u5b58\u653e\u6240\u6709\u8fd9\u4e9b\u53c2\u6570\u5728\u7528\u6237\u7a7a\u95f4\u5730\u5740\u7684\u6307\u9488\u3002"}),"\n",(0,l.jsx)("div",{style:{textAlign:"center"},children:(0,l.jsx)("img",{src:s(67847).A,style:{zoom:"50%"}})}),"\n",(0,l.jsx)(e.h2,{id:"55-\u7cfb\u7edf\u8c03\u7528\u7684\u5b9e\u73b0",children:"5.5 \u7cfb\u7edf\u8c03\u7528\u7684\u5b9e\u73b0"}),"\n",(0,l.jsx)(e.h3,{id:"551-\u5b9e\u73b0\u7cfb\u7edf\u8c03\u7528",children:"5.5.1 \u5b9e\u73b0\u7cfb\u7edf\u8c03\u7528"}),"\n",(0,l.jsx)(e.p,{children:"\u65b0\u7cfb\u7edf\u8c03\u7528\u7684\u53c2\u6570\u3001\u8fd4\u56de\u503c \u548c\u9519\u8bef\u7801\u3002"}),"\n",(0,l.jsxs)(e.p,{children:["\u4e0d\u63d0\u4f9b\u91c7\u7528\u591a\u7528\u9014\u7684\u7cfb\u7edf\u8c03\u7528\uff1a",(0,l.jsx)(e.code,{children:"ioctl as an example of what not to do"})]}),"\n",(0,l.jsx)(e.p,{children:"\u63a5\u53e3\u8bbe\u8ba1\uff1a"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:"\u529b\u6c42\u7b80\u6d01\uff0c\u53c2\u6570\u5c3d\u53ef\u80fd\u5c11\u3002"}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:"\u529b\u6c42\u7a33\u5b9a\uff0c\u4e0d\u505a\u6539\u52a8\u3002"}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:"\u5411\u540e\u517c\u5bb9\u3002"}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:"\u901a\u7528"}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:"\u76ee\u7684\u53ef\u80fd\u4e0d\u53d8\uff0c\u4f46\u7528\u6cd5\u53ef\u80fd\u6539\u53d8"}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:"\u53ef\u79fb\u690d"}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:"\u786e\u4fdd\u4e0d\u5bf9\u7cfb\u7edf\u8c03\u7528\u505a\u9519\u8bef\u7684\u5047\u8bbe"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.blockquote,{children:["\n",(0,l.jsx)(e.p,{children:"\u63d0\u4f9b\u673a\u5236\u800c\u4e0d\u662f\u7b56\u7565\u3002"}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"552-\u53c2\u6570\u9a8c\u8bc1",children:"5.5.2 \u53c2\u6570\u9a8c\u8bc1"}),"\n",(0,l.jsx)(e.p,{children:"\u63a5\u6536\u7528\u6237\u7a7a\u95f4\u7684\u6307\u9488\u4e4b\u524d,\u5185\u6838\u5fc5\u987b\u4fdd\u8bc1:"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u6307\u9488\u6307\u5411\u7684\u5185\u5b58\u533a\u57df\u5c5e\u4e8e\u7528\u6237\u7a7a\u95f4."}),"\n",(0,l.jsx)(e.li,{children:"\u6307\u9488\u6307\u5411\u7684\u5185\u5b58\u533a\u57df\u5728\u8fdb\u7a0b\u7684\u5730\u5740\u7a7a\u95f4\u4e4b\u5185."}),"\n",(0,l.jsx)(e.li,{children:"\u8bfb, \u5199, \u6267\u884c. \u6807\u8bb0\u5185\u5b58\u8bbf\u95ee\u9650\u5236."}),"\n"]}),"\n",(0,l.jsx)(e.p,{children:"\u5411\u7528\u6237\u7a7a\u95f4\u5199\u6570\u636e:"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-c",children:"copy_to_user()\n"})}),"\n",(0,l.jsx)(e.p,{children:"\u4ece\u7528\u6237\u7a7a\u95f4\u8bfb\u6570\u636e:"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-c",children:"copy_from_user()\n"})}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-c",children:"/*\n * silly_copy() \u6ca1\u6709\u5b9e\u9645\u4ef7\u503c, \u4ec5\u4e3a\u89c2\u5bdf\u5185\u6838\u7a7a\u95f4\u548c\u7528\u6237\u7a7a\u95f4\u7684\u6570\u636e\u62f7\u8d1d\n */\n\nSYSCALL_DEFINE3(\n    silly_copy, unsigned long *, src unsigned long *, dst, unsigned long len)\n{\n unsigned long buf;\n\n if (copy_from_user(&buf, src, len)) {\n  return -EFAULT;\n }\n\n if (copy_to_user(dst, &buf, len)) {\n  return -EFAULT;\n }\n\n return len;\n}\n"})}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.code,{children:"copy_to_user()"}),"\u548c",(0,l.jsx)(e.code,{children:"copy_from_user()"}),"\u5f53\u5305\u542b\u7528\u6237\u6570\u636e\u7684\u9875\u88ab\u6362\u51fa\u5230\u786c\u76d8\u4e0a\u800c\u4e0d\u662f\u7269\u7406\u5185\u5b58\u4e0a\u7684\u65f6\u5019, \u90fd\u6709\u53ef\u80fd\u5f15\u8d77\u963b\u585e."]}),"\n",(0,l.jsxs)(e.p,{children:[(0,l.jsx)(e.code,{children:"reboot()"}),"\u7cfb\u7edf\u8c03\u7528\u7b2c\u4e00\u6b65\u662f\u786e\u4fdd\u8c03\u7528\u8fdb\u7a0b\u5177\u6709",(0,l.jsx)(e.code,{children:"CAP_SYS_REBOOT"}),"\u6743\u80fd\u3002\u5982\u679c\u8fd9\u53e5\u88ab\u5220\u9664\uff0c\u4efb\u4f55\u8fdb\u7a0b\u90fd\u53ef\u4ee5\u542f\u52a8\u7cfb\u7edf\u4e86\u3002"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-c",children:"/*\n * Reboot system call: for obvious reasons only root may call it,\n * and even root needs to set up some magic numbers in the registers\n * so that some mistake won't make this reboot the whole machine.\n * You can also set the meaning of the ctrl-alt-del-key here.\n *\n * reboot doesn't sync: do that yourself before calling this.\n */\nSYSCALL_DEFINE4(reboot, int, magic1, int, magic2, unsigned int, cmd,\n  void __user *, arg)\n{\n char buffer[256];\n int ret = 0;\n\n /* We only trust the superuser with rebooting the system. */\n if (!capable(CAP_SYS_BOOT))\n  return -EPERM;\n\n /*\n         * For safety, we require \"magic\" arguments.\n         * TODO: \u4f46\u4e3a\u4ec0\u4e48\u66f4\u5b89\u5168\uff1f\u5177\u4f53\u8868\u73b0\u5728\u54ea\uff1f\n         */\n if (magic1 != LINUX_REBOOT_MAGIC1 ||\n     (magic2 != LINUX_REBOOT_MAGIC2 &&\n                 magic2 != LINUX_REBOOT_MAGIC2A &&\n   magic2 != LINUX_REBOOT_MAGIC2B &&\n                 magic2 != LINUX_REBOOT_MAGIC2C))\n  return -EINVAL;\n\n /* Instead of trying to make the power_off code look like\n  * halt when pm_power_off is not set do it the easy way.\n  */\n if ((cmd == LINUX_REBOOT_CMD_POWER_OFF) && !pm_power_off)\n  cmd = LINUX_REBOOT_CMD_HALT;\n\n mutex_lock(&reboot_mutex);\n switch (cmd) {\n case LINUX_REBOOT_CMD_RESTART:\n  kernel_restart(NULL);\n  break;\n\n case LINUX_REBOOT_CMD_CAD_ON:\n  C_A_D = 1;\n  break;\n\n case LINUX_REBOOT_CMD_CAD_OFF:\n  C_A_D = 0;\n  break;\n\n case LINUX_REBOOT_CMD_HALT:\n  kernel_halt();\n  do_exit(0);\n  panic(\"cannot halt\");\n\n case LINUX_REBOOT_CMD_POWER_OFF:\n  kernel_power_off();\n  do_exit(0);\n  break;\n\n case LINUX_REBOOT_CMD_RESTART2:\n  if (strncpy_from_user(&buffer[0], arg, sizeof(buffer) - 1) < 0) {\n   ret = -EFAULT;\n   break;\n  }\n  buffer[sizeof(buffer) - 1] = '\\0';\n\n  kernel_restart(buffer);\n  break;\n\n#ifdef CONFIG_KEXEC\n case LINUX_REBOOT_CMD_KEXEC:\n  ret = kernel_kexec();\n  break;\n#endif\n\n#ifdef CONFIG_HIBERNATION\n case LINUX_REBOOT_CMD_SW_SUSPEND:\n  ret = hibernate();\n  break;\n#endif\n\n default:\n  ret = -EINVAL;\n  break;\n }\n mutex_unlock(&reboot_mutex);\n return ret;\n}\n"})}),"\n",(0,l.jsxs)(e.p,{children:["\u6743\u80fd\u5217\u8868\u53c2\u89c1 ",(0,l.jsx)(e.code,{children:"<linux/capability>"})]}),"\n",(0,l.jsx)(e.h2,{id:"56-\u7cfb\u7edf\u8c03\u7528\u4e0a\u4e0b\u6587",children:"5.6 \u7cfb\u7edf\u8c03\u7528\u4e0a\u4e0b\u6587"}),"\n",(0,l.jsx)(e.p,{children:"\u5728\u8fdb\u7a0b\u4e0a\u4e0b\u6587\u4e2d\uff0c\u5185\u6838\u53ef\u4ee5\u4f11\u7720\u5e76\u4e14\u53ef\u4ee5\u88ab\u62a2\u5360\u3002"}),"\n",(0,l.jsx)(e.h3,{id:"561-\u7ed1\u5b9a\u4e00\u4e2a\u7cfb\u7edf\u8c03\u7528\u7684\u6700\u540e\u6b65\u9aa4",children:"5.6.1 \u7ed1\u5b9a\u4e00\u4e2a\u7cfb\u7edf\u8c03\u7528\u7684\u6700\u540e\u6b65\u9aa4"}),"\n",(0,l.jsxs)(e.ol,{children:["\n",(0,l.jsx)(e.li,{children:"\u9996\u5148\uff0c\u5728\u7cfb\u7edf\u8c03\u7528\u8868\u7684\u6700\u540e\u52a0\u5165\u4e00\u4e2a\u8868\u9879\u3002"}),"\n",(0,l.jsxs)(e.li,{children:["\u5bf9\u4e8e\u6240\u652f\u6301\u7684\u5404\u79cd\u4f53\u7cfb\u7ed3\u6784\uff0c\u7cfb\u7edf\u8c03\u7528\u53f7\u90fd\u5fc5\u987b\u5b9a\u4e49\u4e8e",(0,l.jsx)(e.code,{children:"<asm/unistd.h>"}),"\u4e2d\u3002"]}),"\n",(0,l.jsxs)(e.li,{children:["\u7cfb\u7edf\u8c03\u7528\u5fc5\u987b\u88ab\u7f16\u8bd1\u8fdb\u5185\u6838\u6620\u8c61\uff08\u4e0d\u80fd\u88ab\u7f16\u8bd1\u6210\u6a21\u5757\uff09\u3002\u8fd9\u53ea\u8981\u628a\u5b83\u653e\u8fdb kernel/ \u4e0b\u7684\u4e00\u4e2a\u76f8\u5173\u6587\u4ef6\u4e2d\uff0c\u6bd4\u5982",(0,l.jsx)(e.code,{children:"sys.c"})]}),"\n"]}),"\n",(0,l.jsxs)(e.p,{children:["\u4f8b\u5982\u52a0\u5165 ",(0,l.jsx)(e.code,{children:"sys_foo"})," \u7cfb\u7edf\u8c03\u7528"]}),"\n",(0,l.jsxs)(e.ol,{children:["\n",(0,l.jsxs)(e.li,{children:["\u52a0\u5165\u7cfb\u7edf\u8c03\u7528\u8868\n",(0,l.jsx)(e.code,{children:"entry.S"}),":"]}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{children:'c\nENTRY(sys_call_table)\n    .long sys_restart_syscall /* 0 - old "setup()" system call, used for restarting */\n          /* ... */\n    .long sys_recvmmsg\n    .long sys_foo\n'})}),"\n",(0,l.jsxs)(e.ol,{start:"2",children:["\n",(0,l.jsxs)(e.li,{children:["\u52a0\u5165\u7cfb\u7edf\u8c03\u7528\u53f7\u5230\u3000",(0,l.jsx)(e.code,{children:"<asm/unistd.h>"})]}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-c",children:"/* at least 8 syscall per cacheline */\n#define __NR_read    0\n__SYSCALL(__NR_read, sys_read)\n/* ... */\n#define __NR_recvmmsg    299\n__SYSCALL(__NR_recvmmsg, sys_recvmmsg)\n/* at least 8 syscall per cacheline */\n#define __NR_read    0\n__SYSCALL(__NR_read, sys_read)\n/* ... */\n#define __NR_recvmmsg    299\n__SYSCALL(__NR_recvmmsg, sys_recvmmsg)\n\n#define __NR_foo    299\n__SYSCALL(__NR_foo, sys_foo)\n"})}),"\n",(0,l.jsxs)(e.ol,{start:"3",children:["\n",(0,l.jsxs)(e.li,{children:["\u6700\u540e\u5b9e\u73b0\u7cfb\u7edf\u8c03\u7528",(0,l.jsx)(e.code,{children:"sys_foo"})]}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-c",children:"asmlinkage long sys_foo(void)\n{\n        return THREAD_SIZE;\n}\n"})}),"\n",(0,l.jsx)(e.h3,{id:"562-\u4ece\u7528\u6237\u7a7a\u95f4\u8bbf\u95ee\u7cfb\u7edf\u8c03\u7528",children:"5.6.2 \u4ece\u7528\u6237\u7a7a\u95f4\u8bbf\u95ee\u7cfb\u7edf\u8c03\u7528"}),"\n",(0,l.jsxs)(e.p,{children:["\u63d0\u4f9b ",(0,l.jsx)(e.code,{children:"_syscallN()"}),", N\u7684\u8303\u56f4\u4ece0\u52306\uff0c\u4ee3\u8868\u9700\u8981\u4f20\u9012\u7ed9\u7cfb\u7edf\u8c03\u7528\u7684\u53c2\u6570\u4e2a\u6570\u3002"]}),"\n",(0,l.jsxs)(e.p,{children:["\u8c03\u7528 ",(0,l.jsx)(e.code,{children:"foo()"}),"\u7cfb\u7edf\u8c03\u7528\u7684\u5b8f"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-c",children:'#define __NR_foo 300#define __NR_foo 300\n__syscall0(long, foo)\n\n\nint main()\n{\n        long stack_size;\n\n        stack_size = foo();\n        printf("The kernel stack size is %ld\\n", stack_size);\n\n        return 0;\n}\n\n'})}),"\n",(0,l.jsx)(e.h3,{id:"563-\u4e3a\u4ec0\u4e48\u4e0d\u901a\u8fc7\u7cfb\u7edf\u8c03\u7528\u7684\u65b9\u5f0f\u5b9e\u73b0",children:"5.6.3 \u4e3a\u4ec0\u4e48\u4e0d\u901a\u8fc7\u7cfb\u7edf\u8c03\u7528\u7684\u65b9\u5f0f\u5b9e\u73b0"}),"\n",(0,l.jsx)(e.p,{children:"\u5efa\u7acb\u65b0\u7684\u7cfb\u7edf\u8c03\u7528\u7684\u597d\u5904\uff1a"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u7cfb\u7edf\u8c03\u7528\u521b\u5efa\u5bb9\u6613\u4e14\u4f7f\u7528\u65b9\u4fbf"}),"\n",(0,l.jsx)(e.li,{children:"Linux \u7cfb\u7edf\u8c03\u7528\u9ad8\u6027\u80fd\n\u5f0a\u7aef:"}),"\n",(0,l.jsx)(e.li,{children:"\u9700\u8981\u4e00\u4e2a\u7cfb\u7edf\u8c03\u7528\u53f7\uff0c\u9700\u8981\u5728\u5f00\u53d1\u7248\u672c\u65f6\u7531\u5b98\u65b9\u5206\u914d"}),"\n",(0,l.jsx)(e.li,{children:"\u7cfb\u7edf\u8c03\u7528\u88ab\u52a0\u5165\u7a33\u5b9a\u5185\u6838\u540e\u88ab\u56fa\u5316\uff0c\u63a5\u53e3\u4e0d\u5141\u8bb8\u4fee\u6539"}),"\n",(0,l.jsx)(e.li,{children:"\u9700\u8981\u5c06\u7cfb\u7edf\u8c03\u7528\u5206\u522b\u6ce8\u518c\u5230\u6bcf\u4e2a\u9700\u8981\u652f\u6301\u7684\u4f53\u7cfb\u7ed3\u6784"}),"\n",(0,l.jsx)(e.li,{children:"\u5728\u811a\u672c\u4e2d\u4e0d\u5bb9\u6613\u8c03\u7528\u7cfb\u7edf\u8c03\u7528\uff0c\u4e5f\u4e0d\u80fd\u4ece\u6587\u4ef6\u7cfb\u7edf\u76f4\u63a5\u8bbf\u95ee\u7cfb\u7edf\u8c03\u7528"}),"\n",(0,l.jsx)(e.li,{children:"\u56e0\u4e3a\u9700\u8981\u7cfb\u7edf\u8c03\u7528\u53f7\uff0c\u5728\u4e3b\u5185\u6838\u6811\u4e4b\u5916\u96be\u4ee5\u7ef4\u62a4\u548c\u4f7f\u7528"}),"\n",(0,l.jsx)(e.li,{children:"\u4ec5\u8fdb\u884c\u6570\u636e\u4ea4\u6362\u65f6\u5927\u6750\u5c0f\u7528\n\u66ff\u4ee3\u65b9\u6cd5:"}),"\n",(0,l.jsxs)(e.li,{children:["\u5b9e\u73b0\u4e00\u4e2a\u8bbe\u5907\u8282\u70b9\uff0c\u5e76\u5bf9\u6b64\u5b9e\u73b0",(0,l.jsx)(e.code,{children:"read()"}),"\u548c",(0,l.jsx)(e.code,{children:"write()"}),"\u3002\u4f7f\u7528",(0,l.jsx)(e.code,{children:"ioctl()"}),"\u5bf9\u7279\u5b9a\u7684\u8bbe\u7f6e\u8fdb\u884c\u64cd\u4f5c\u6216\u68c0\u7d22"]}),"\n"]})]})}function _(n={}){const{wrapper:e}={...(0,i.R)(),...n.components};return e?(0,l.jsx)(e,{...n,children:(0,l.jsx)(h,{...n})}):h(n)}},99372:(n,e,s)=>{s.d(e,{A:()=>r});const r=s.p+"assets/images/fig5.1-50316ec81f98a4171ac464302858590c.png"},67847:(n,e,s)=>{s.d(e,{A:()=>r});const r=s.p+"assets/images/fig5.2-f0303e96c84aa1369a2f24fc5208ccb1.png"},28453:(n,e,s)=>{s.d(e,{R:()=>c,x:()=>d});var r=s(96540);const l={},i=r.createContext(l);function c(n){const e=r.useContext(i);return r.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function d(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(l):n.components||l:c(n.components),r.createElement(i.Provider,{value:e},n.children)}}}]);